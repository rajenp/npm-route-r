/*! route-r 2015-03-04 */
!function(){"use strict";var a=require("http"),b=require("querystring"),c={parse:function(a,c){var d,e,f,g=[],h={},i=a.indexOf("?");return i>0&&(d=a.substring(i+1),a=a.substring(0,i),h=b.parse(d)),e=c.replace(/\/\:([^\:\/]+)/gim,function(){return g.push(arguments[1]),"/([^/]+)"}),e+="$",f=a.match(e),f?(f.shift(),f.forEach(function(a){h[g.shift()]=a}),h):void 0}},d=function(a){return{code:a}},e=function(){return{on:[],get:[],put:[],post:[],"delete":[],options:[],head:[],trace:[],connect:[]}},f=e(),g={onRequestBody:function(a,b){var c,d,e="";a.on("data",function(a){e+=a.toString()}),a.on("end",function(){d=a.headers["content-type"]||a.headers["Content-Type"],c=e&&"application/json"===d?JSON.parse(e):e,b({data:c})})},sendJSON:function(a,b){a.write(JSON.stringify(b)),a.end()},sendResult:function(b,c){c=c||d(404),c.code=c.code||200,c.message=c.message||a.STATUS_CODES[c.code],c.data&&"object"==typeof c.data&&b.setHeader("Content-Type","application/json"),c.downloadAs&&(c.data=c.data.toString(),b.setHeader("Content-Type","application/octet-stream"),b.setHeader("Content-Disposition",'attachment; filename="'+c.downloadAs+'"')),b.writeHead(c.code,c.message,c.headers||{}),c.data?"object"==typeof c.data?g.sendJSON(b,c.data):(b.write(c.data),b.end()):b.end()},resetRoutes:function(){f=e()}},h=function(){var b,e=function(a,b){var e,h,i=0,j=f[a.method.toLowerCase()],k=j.length,l=d(404),m=function(c){a.body=c.data,l=e.handler(a,b),l=l||d(501),g.sendResult(b,l)};for(j.length<1&&(j=f.on,k=j.length);k>i;){if(e=j[i],h=c.parse(a.url,e.path))return a.params=h,"POST"===a.method||"PUT"===a.method?void g.onRequestBody(a,m):void m({});i+=1}g.sendResult(b,l)},h=function(a,b){var c=f[a];c&&c.push(b)};return{on:function(a,b){return h("on",{path:a,handler:b}),this},onGet:function(a,b){return h("get",{path:a,handler:b}),this},onPut:function(a,b){return h("put",{path:a,handler:b}),this},onDelete:function(a,b){return h("delete",{path:a,handler:b}),this},onPost:function(a,b){return h("post",{path:a,handler:b}),this},onOptions:function(a,b){return h("options",{path:a,handler:b}),this},onHead:function(a,b){return h("head",{path:a,handler:b}),this},onTrace:function(a,b){return h("trace",{path:a,handler:b}),this},onConnect:function(a,b){return h("connect",{path:a,handler:b}),this},start:function(c){if(!c||"number"!=typeof c)throw new Error("Invalid port number: "+c);b=a.createServer(e).listen(c)},stop:function(a){b&&b.close(a),g.resetRoutes()}}}();exports.server=h}(exports);